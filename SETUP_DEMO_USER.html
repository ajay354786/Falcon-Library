<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Demo User - Falcon Library</title>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .button {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 0;
        }
        .button:hover {
            background: #5568d3;
        }
        .status {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            text-align: center;
        }
        .success {
            background: #efe;
            color: #3c3;
            border: 1px solid #9f9;
        }
        .error {
            background: #fee;
            color: #c33;
            border: 1px solid #f99;
        }
        .info {
            background: #eef;
            color: #33c;
            border: 1px solid #99f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü¶Ö Setup Demo User & Data</h1>
        <div id="status"></div>
        <button class="button" onclick="setupDemoData()">Complete Setup ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
        <button class="button" onclick="location.href='index.html'" style="background: #999;">Back to Login</button>
        <div id="progress" style="display:none; margin-top: 20px;">
            <div id="steps"></div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBAtNUphUmqc4SuS3sekVGLHSar1q7FB0o",
            authDomain: "falcon-library-add3e.firebaseapp.com",
            projectId: "falcon-library-add3e",
            storageBucket: "falcon-library-add3e.firebasestorage.app",
            messagingSenderId: "7061237231",
            appId: "1:7061237231:web:24337d7143b92e26125a1a",
            measurementId: "G-N7WJ92GKDW"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function addStep(stepName, status) {
            const stepsDiv = document.getElementById('steps');
            const stepEl = document.createElement('div');
            stepEl.innerHTML = `<div style="padding: 8px; margin: 5px 0;">${stepName}: <strong>${status}</strong></div>`;
            stepsDiv.appendChild(stepEl);
            console.log(`${stepName}: ${status}`);
        }

        async function setupDemoData() {
            const statusDiv = document.getElementById('status');
            const progressDiv = document.getElementById('progress');
            const stepsDiv = document.getElementById('steps');
            
            statusDiv.innerHTML = '<div class="status info">‚è≥ ‡§∏‡•á‡§ü‡§Ö‡§™ ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>';
            progressDiv.style.display = 'block';
            stepsDiv.innerHTML = '';
            
            try {
                // Step 1: Create demo user
                addStep('Demo User ‡§¨‡§®‡§æ‡§®‡§æ', '‚è≥ Processing...');
                const existingUser = await db.collection('users').where('email', '==', 'student@falcon.com').get();
                
                if (existingUser.empty) {
                    const demoUser = {
                        email: "student@falcon.com",
                        password: "student123",
                        fullName: "Demo Student",
                        role: "student",
                        createdAt: new Date().toISOString(),
                        lastLogin: null,
                        studentData: {
                            mobile: '9876543210',
                            joiningDate: '2026-01-01',
                            seatNumber: '',
                            shift: '',
                            status: 'Active'
                        }
                    };
                    await db.collection('users').add(demoUser);
                    addStep('Demo User ‡§¨‡§®‡§æ‡§®‡§æ', '‚úì Done');
                } else {
                    addStep('Demo User ‡§¨‡§®‡§æ‡§®‡§æ', '‚ö†Ô∏è Already Exists');
                }

                // Step 2: Create settings
                addStep('Settings ‡§¨‡§®‡§æ‡§®‡§æ', '‚è≥ Processing...');
                const settings = {
                    totalSeats: 50,
                    monthlyFee: 1500,
                    libraryRules: 'Welcome to Falcon Library!\n\n1. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§≤‡§æ‡§á‡§¨‡•ç‡§∞‡•á‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§ö‡•Å‡§™‡•ç ‡§∞‡§π‡•á‡§Ç‡•§\n2. ‡§Ö‡§™‡§®‡•Ä seat ‡§ï‡•ã ‡§∏‡§æ‡§´ ‡§∞‡§ñ‡•á‡§Ç‡•§\n3. ‡§ñ‡§æ‡§®‡§æ-‡§™‡•Ä‡§®‡§æ ‡§Ö‡§®‡•Å‡§Æ‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§\n4. ‡§â‡§ß‡§æ‡§∞ ‡§¶‡•Ä ‡§ó‡§à ‡§ï‡§ø‡§§‡§æ‡§¨‡•á‡§Ç ‡§∏‡§Æ‡§Ø ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§\n5. ‡§Ö‡§®‡•ç‡§Ø ‡§õ‡§æ‡§§‡•ç‡§∞‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡§Æ‡•ç‡§Æ‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§',
                    lastUpdate: new Date().toLocaleDateString('en-IN')
                };
                await db.collection('settings').doc('library').set(settings);
                addStep('Settings ‡§¨‡§®‡§æ‡§®‡§æ', '‚úì Done');

                // Step 3: Create shifts
                addStep('Shifts ‡§¨‡§®‡§æ‡§®‡§æ', '‚è≥ Processing...');
                const shifts = {
                    morning: { start: '06:00', end: '12:00' },
                    evening: { start: '14:00', end: '20:00' },
                    fullDay: { start: '06:00', end: '20:00' }
                };
                await db.collection('shifts').doc('library').set(shifts);
                addStep('Shifts ‡§¨‡§®‡§æ‡§®‡§æ', '‚úì Done');

                // Step 4: Create demo students
                addStep('Demo Students ‡§¨‡§®‡§æ‡§®‡§æ', '‚è≥ Processing...');
                const demoStudents = [
                    {
                        id: 'STU_001',
                        name: 'Amit Kumar',
                        mobile: '9876543210',
                        joiningDate: '2026-01-01',
                        seatNumber: 1,
                        shift: 'Morning',
                        status: 'Active',
                        photo: null
                    },
                    {
                        id: 'STU_002',
                        name: 'Priya Singh',
                        mobile: '9876543211',
                        joiningDate: '2026-01-05',
                        seatNumber: 2,
                        shift: 'Evening',
                        status: 'Active',
                        photo: null
                    },
                    {
                        id: 'STU_003',
                        name: 'Raj Patel',
                        mobile: '9876543212',
                        joiningDate: '2026-01-10',
                        seatNumber: 3,
                        shift: 'Full Day',
                        status: 'Active',
                        photo: null
                    }
                ];
                
                for (let student of demoStudents) {
                    const existingStudent = await db.collection('students').doc(student.id).get();
                    if (!existingStudent.exists) {
                        await db.collection('students').doc(student.id).set(student);
                    }
                }
                addStep('Demo Students ‡§¨‡§®‡§æ‡§®‡§æ', `‚úì Done (${demoStudents.length})`);

                // Step 5: Create demo payments
                addStep('Demo Payments ‡§¨‡§®‡§æ‡§®‡§æ', '‚è≥ Processing...');
                const demoPayments = [
                    {
                        id: 'PAY_001',
                        studentId: 'STU_001',
                        month: '2026-02',
                        amount: 1500,
                        status: 'Paid',
                        dueDate: '2026-02-28',
                        paymentDate: '2026-02-05',
                        notes: 'February payment'
                    },
                    {
                        id: 'PAY_002',
                        studentId: 'STU_002',
                        month: '2026-02',
                        amount: 1500,
                        status: 'Unpaid',
                        dueDate: '2026-02-28',
                        paymentDate: null,
                        notes: 'Pending'
                    }
                ];
                
                for (let payment of demoPayments) {
                    const existingPayment = await db.collection('payments').doc(payment.id).get();
                    if (!existingPayment.exists) {
                        await db.collection('payments').doc(payment.id).set(payment);
                    }
                }
                addStep('Demo Payments ‡§¨‡§®‡§æ‡§®‡§æ', `‚úì Done (${demoPayments.length})`);

                // Success message
                statusDiv.innerHTML = `
                    <div class="status success">
                        <h2>‚úì ‡§∏‡•á‡§ü‡§Ö‡§™ ‡§™‡•Ç‡§∞‡§æ ‡§π‡•Å‡§Ü!</h2>
                        <p style="text-align: left;">
                            <strong>Login ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è:</strong><br><br>
                            üìß <strong>Email:</strong> student@falcon.com<br>
                            üîê <strong>Password:</strong> student123<br><br>
                            ‚úÖ Demo Data Created:<br>
                            ‚Ä¢ 1 Demo User<br>
                            ‚Ä¢ 3 Demo Students<br>
                            ‚Ä¢ 2 Demo Payments<br>
                            ‚Ä¢ Settings & Shifts
                        </p>
                    </div>
                `;
                
                console.log('‚úÖ Complete Setup Successful!');

            } catch (error) {
                updateStatus(`‚ùå Error: ${error.message}`, 'error');
                console.error('Setup Error:', error);
            }
        }

        // Auto-check on load
        window.addEventListener('load', function() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = '<div class="status info">‚ÑπÔ∏è Click button to setup demo user & data...</div>';
        });
    </script>
</body>
</html>
